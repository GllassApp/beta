<!DOCTYPE html>
<html>

<head>
    <title>Gllass Beta</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
</head>

<body>
    <canvas id="myChart"></canvas>
    <form id="upload-file" method="post" enctype="multipart/form-data">
        <fieldset>
            <label for="file">Select a file</label>
            <input name="image" type="file">
        </fieldset>
        <fieldset>
            <button id="upload-file-btn" type="button">Upload</button>
        </fieldset>
    </form>
    <!-- <p>Date: <input id="datepicker"></p> -->
    <p id="prediction"></p>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
    <script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
    <script>
    function sortFunction(a, b) {
        if (a[1] === b[1]) {
            return 0;
        } else {
            return (a[1] < b[1]) ? -1 : 1;
        }
    }

    $.getJSON('http://53f6a570.ngrok.io/tags', function(data) {
        array_elements = [].concat.apply([], data.recurring);
        array_elements.sort();
        var current = null;
        var cnt = 0;
        recurse = [];
        datas = [];
        labels = [];
        backgroundcolors = [];
        bordercolors = [];
        for (var i = 0; i < array_elements.length; i++) {
            if (array_elements[i] != current) {
                if (cnt > 0) {
                	recurse.push([current, cnt])
                    labels.push(current);
                    datas.push(cnt)
                    backgroundcolors.push('rgba(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ', .4)');
                    bordercolors.push('rgba(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ', .4)');
                }
                current = array_elements[i];
                cnt = 1;
            } else {
                cnt++;
            }
        }
        if (cnt > 0) {
            datas.push(cnt);
            labels.push(current);
            recurse.push([current, cnt])
        }
        recurse = recurse.sort(sortFunction).reverse();
        recurse = _.unzip(recurse);
        var data = {
            labels: recurse[0].reverse(),
            datasets: [{
                label: "Most recurring tags",
                backgroundColor: bordercolors,
                borderColor: backgroundcolors,
                borderWidth: 1,
                data: recurse[1].reverse(),
                options: null
            }]
        };
        var ctx = $("#myChart");
        var myBarChart = new Chart(ctx, {
            type: 'bar',
            data: data
        });
    });
    $(function() {
        // $('#datepicker').datepicker();

        $('#upload-file-btn').click(function() {
            /*var date = $('#datepicker').datepicker('getDate');

            if (date === null) {
            	date = new Date();
            }*/

            var form_data = new FormData($('#upload-file')[0]);
            $('#prediction').text('Calculating...');
            $.ajax({
                type: 'POST',
                url: 'http://53f6a570.ngrok.io/process-image',
                data: form_data,
                contentType: false,
                cache: false,
                processData: false,
                async: false,
                success: function(data) {
                    $('#prediction').text('Predicted Number of Likes: ' + data.prediction)
                },
            });
        });
    });
    </script>
</body>

</html>
