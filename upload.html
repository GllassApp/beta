<!DOCTYPE html>
<html>

<head>
    <title>Gllass Â· Home</title>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
    <script type="text/javascript">
    new WOW().init();
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/js/materialize.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
</head>

<body>
    <div class="row" align="center">
        <div class="col s12 m6">
            <h3 class="fonttest" font="Regular">Most popular themes</h3>
            <canvas id="popular"></canvas>
            <h5 class="fonttest" font="Regular">These are what are in your pictures that your followers like to see.</h5>
        </div>
        <div class="col s12 m6">
            <h3 class="fonttest" font="Regular">Most recurrent themes</h3>
            <canvas id="recurrent"></canvas>
            <h5 class="fonttest" font="Regular">These are what come up the most in your pictures</h5>
        </div>
    </div>
    <div class="container" align="center">
        <form id="upload-file" method="post" enctype="multipart/form-data">
            <h3 class="fonttest" font="Regular">Upload a picture here to predict how many likes it will get!</h3>
            <fieldset>
                <label for="file">Select a file</label>
                <input name="image" type="file">
            </fieldset>
            <fieldset>
                <button class="btn waves-effect waves-light black" name="action" id="upload-file-btn" onclick="alert('Predicting');predict()" type="button">Submit
                    <i class="fa fa-telegram"></i>
                </button>
            </fieldset>
            <h4 class="fonttest" font="Regular" id="prediction"></h4>
        </form>
    </div>
    <!-- <p>Date: <input id="datepicker"></p> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
    <script type="text/javascript" src="Chart.js"></script>
    <script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
    <script>
    function sortFunction(a, b) {
        if (a[1] === b[1]) {
            return 0;
        } else {
            return (a[1] < b[1]) ? -1 : 1;
        }
    }
    $(".fonttest").click(function() {
        $(this).css('font-family', $(this).attr('font'));
    });
    $(".fonttest").click();
    $.getJSON('http://53f6a570.ngrok.io/tags', function(data) {
        console.log(data)
        bcolors = [];
        bgcolors = [];
        for (var a = 0; a <= 8; a++) {
            bcolors.push('rgba(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ', .4)');
            bgcolors.push('rgba(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ', .4)');
        }
        var topten = _.unzip(data.topten);
        var topdata = {
            labels: topten[0],
            datasets: [{
                label: "Most popular tags",
                backgroundColor: bcolors,
                borderColor: bgcolors,
                borderWidth: 1,
                data: topten[1],
                options: null
            }]
        };
        var ctx2 = $("#popular");
        var popular = new Chart(ctx2, {
            type: 'bar',
            data: topdata
        });
        array_elements = [].concat.apply([], data.recurring);
        ae = data;
        array_elements.sort();
        var current = null;
        var cnt = 0;
        recurse = [];
        datas = [];
        labels = [];
        backgroundcolors = [];
        bordercolors = [];
        for (var i = 0; i < array_elements.length; i++) {
            if (array_elements[i] != current) {
                if (cnt > 0) {
                    recurse.push([current, cnt])
                    labels.push(current);
                    datas.push(cnt)
                    backgroundcolors.push('rgba(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ', .4)');
                    bordercolors.push('rgba(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) + ', .4)');
                }
                current = array_elements[i];
                cnt = 1;
            } else {
                cnt++;
            }
        }
        if (cnt > 0) {
            datas.push(cnt);
            labels.push(current);
            recurse.push([current, cnt])
        }
        recurse = recurse.sort(sortFunction).reverse();
        recurse = _.unzip(recurse);
        recurring = recurse[0].slice(0, 10)
        var data = {
            labels: recurring,
            datasets: [{
                label: "Most recurring tags",
                backgroundColor: bordercolors,
                borderColor: backgroundcolors,
                borderWidth: 1,
                data: recurse[1].slice(0, 10),
                options: null
            }]
        };
        var ctx = document.getElementById("recurrent").getContext("2d");
        var recurrent = new Chart(ctx, {
            type: 'bar',
            data: data
        });
        console.log(recurrent)
    });


    function predict() {
        /*var date = $('#datepicker').datepicker('getDate');

        if (date === null) {
            date = new Date();
        }*/

        var form_data = new FormData($('#upload-file')[0]);
        $('#prediction').text('Calculating...');
        $.ajax({
            type: 'POST',
            url: 'http://53f6a570.ngrok.io/process-image',
            data: form_data,
            contentType: false,
            cache: false,
            processData: false,
            async: false,
            success: function(data) {
                $('#prediction').text('Predicted Number of Likes: ' + Math.floor(data.prediction))
            },
        });
    }
    </script>
</body>

</html>
